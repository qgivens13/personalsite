@using personalsite.Models

<div class="bg-[#2A2A2A] border border-[#3A3A3A] rounded-lg p-6 shadow-sm">
    <h3 class="text-lg font-semibold text-white mb-6">@Title</h3>
    
    <div class="flex flex-col lg:flex-row items-center justify-center gap-8">
        <!-- Donut Chart -->
        <div class="relative" style="width: 240px; height: 240px;">
            <svg viewBox="0 0 200 200" class="transform -rotate-90">
                @{
                    double currentAngle = 0;
                    foreach (var category in Categories)
                    {
                        var percentage = (double)category.Count / TotalCount;
                        var strokeDashArray = $"{percentage * 565.48} 565.48";
                        var rotation = currentAngle;
                        
                        <circle
                            cx="100"
                            cy="100"
                            r="90"
                            fill="none"
                            stroke="@category.Color"
                            stroke-width="20"
                            stroke-dasharray="@strokeDashArray"
                            transform="rotate(@rotation 100 100)"
                            class="transition-all duration-500"
                            style="opacity: 0.9;"
                        />
                        
                        currentAngle += percentage * 360;
                    }
                }
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <div class="text-3xl font-bold text-white">@TotalCount</div>
                <div class="text-xs text-gray-400">Total</div>
            </div>
        </div>

        <!-- Legend -->
        <div class="flex flex-col gap-3">
            @foreach (var category in Categories)
            {
                var percentage = Math.Round((double)category.Count / TotalCount * 100, 1);
                <div class="flex items-center gap-4 group cursor-pointer hover:bg-[#1A1A1A]/80 p-3 rounded-lg transition-all">
                    <div class="legend-color-box" style="background: @category.Color !important;"></div>
                    <div class="flex-1 min-w-[200px]">
                        <div class="text-sm text-gray-300 group-hover:text-white transition-colors font-medium">
                            @category.Category
                        </div>
                        <div class="text-xs text-gray-500">
                            @category.Count incidents (@percentage%)
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public string Title { get; set; } = "Chart";
    
    [Parameter]
    public List<MeltdownCategory> Categories { get; set; } = new();

    private int TotalCount => Categories.Sum(c => c.Count);
}

<style>
    .legend-color-box {
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
</style>

